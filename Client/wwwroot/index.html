<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>WebAppAssembly</title>
    <base href="/" />
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="css/app.css" rel="stylesheet" />
    <link href="WebAppAssembly.Client.styles.css" rel="stylesheet" />
    <link href="manifest.json" rel="manifest" />
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />
    <link rel="stylesheet" href="css/order_page.min.css">
</head>

<body>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
    <script>
        // object of Telegram app
        const tlg = window.Telegram.WebApp;
        var allowColor = "#55be61"; // #00A86B

        // Informs the Telegram app that the Web App is ready
        function TelegramWebAppInit() {
            console.log("Initialization of the Telegram Bot has started");
            tlg.ready();
            tlg.enableClosingConfirmation();
            return tlg.initDataUnsafe.user.id;
        }

        function SetMainButtonColor(color) {
            allowColor = color;
        }

        // Close Web App
        function CloseWebApp() {
            console.log("Web App has been closed");
            tlg.close();
        }

        // Set 'View' main button
        function SetMainButtonText(txt, isExpand) {
            console.log(txt);
            if (isExpand) {
                tlg.expand();
            }
            tlg.MainButton.setParams({ "text": txt, "color": allowColor, "is_active": true, "is_visible": true });
        }

        // Hide the main button
        function HideMainButton() {
            tlg.MainButton.hide();
        }

        // Gets the main button event
        async function MainButtonHandler() {
            await MainButtonHandlerPromise();
            tlg.HapticFeedback.impactOccurred("soft");
        }

        // Gets the main button event
        function MainButtonHandlerPromise() {
            return new Promise((resolve, reject) => {
                tlg.onEvent('mainButtonClicked', callback => {
                    resolve(true);
                });
            });
        }

        // Show the back button
        function ShowBackButton() {
            tlg.BackButton.show();
        }

        // Hide the back button
        function HideBackButton() {
            tlg.BackButton.hide();
        }

        // Gets the back button event
        async function BackButtonHandler() {
            await BackButtonHandlerPromise();
            tlg.HapticFeedback.impactOccurred("soft");
        }

        // Gets the back button event
        function BackButtonHandlerPromise() {
            return new Promise((resolve, reject) => {
                tlg.onEvent('backButtonClicked', callback => {
                    resolve(true);
                });
            });
        }

        // Gets the invoice events
        async function InvoiceClosedHandler(invoiceLink) {
            return await InvoiceClosedHandlerPromise(invoiceLink);
        }

        // Gets the invoice events
        function InvoiceClosedHandlerPromise(invoiceLink) {
            return new Promise((resolve, reject) => {
                tlg.openInvoice(invoiceLink, callback => {
                    resolve(callback);
                });
            });
        }

        // Set haptic feedback notification
        function SetHapticFeedbackNotification(type) {
            tlg.HapticFeedback.notificationOccurred(type);
        }

        function SetHapticFeedbackImpactOccurred(style) {
            tlg.HapticFeedback.impactOccurred(style);
        }

        // Set haptic feedback of the 'selection changed'
        function SetHapticFeedbackSelectionChanged() {
            tlg.HapticFeedback.selectionChanged();
        }

        // Set 'Ok' message
        function SetOkPopupMessage(title, message) {
            tlg.showPopup({ "title": title, "message": message, "buttons": [{ "type": "ok" }] });
        }

        function ShowProgress(leaveActive) {
            tlg.MainButton.showProgress(leaveActive);
        }

        function HideProgress() {
            tlg.MainButton.hideProgress();
        }

        function ScrollToTop() {
            //window.scrollBy(0, -window.innerHeight);
            //window.scrollBy({top:0});
            window.scrollTo(0, 0);
        }

        async function ShowPopupParamsAsync(popup) {
            console.log(popup);
            var promise = new Promise((resolve, reject) => {
                tlg.showPopup(popup, callback => {
                    resolve(callback);
                });
            });
            return await promise;
        }

        // Just test
        function TestFunction() {
            tlg.showPopup({ "title": "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ", "message": "–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞ —Å–ª–∏—à–∫–æ–º –º–∞–ª–∞", "buttons": [{ "id": "1", "type": "ok" }] });
        }
    </script>

    <div id="app">
        <!--<p style="display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;min-height:100vh;">Loading...</p>-->
        <div class=container4>
            <div class="dots-bars-2"></div>
        </div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">üóô</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script>navigator.serviceWorker.register('service-worker.js');</script>
</body>

</html>
